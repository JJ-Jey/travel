<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org"
	th:replace="layout/layout :: basic(~{::head}, ~{::main})">
	
	<head>
		<!-- include libraries(jQuery, bootstrap) -->
		<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

		<!-- include summernote css/js -->
		<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
		
		<link rel="stylesheet" href="/css/board/list.css">
		
		<!-- jquery summernote 사용하기 -->
		<script type="text/javascript">
			$(function(){
				$('#summernote').summernote();
			});
			
			/* 수정 버튼 누르면 수정 화면으로 변경 */
			function clickedBtnUpdate(){
				/* show()는 display가 block으로 설정되기 때문에 flex를 주기 위해서 css로 설정 */
				$(".detail-update").css("display", "flex");
				$(".detail-default").hide();
			}
			
			function clickedBtnCancel(){
				$(".detail-update").hide();
				$(".detail-default").show();
			}
		</script>
	</head>
	
	<main>
		<h1>메인 영역</h1>
		<div class="warp view-size">
		
		<section id="detail">
			<h1>게시글 내용</h1>
			<div class="wrap">
				<p class="tit">상품 정보</p>
				
				<dl class="flex">
					<dt>상품번호</dt>
					<dd th:text="${detail.pno}"></dd>
				</dl>
				<dl class="flex">
					<dt>판매자</dt>
					<dd th:text="${detail.seller}"></dd>
				</dl>
				<dl class="flex">
					<dt>등록일</dt>
					<dd th:text="${detail.createdDate}"></dd>
				</dl>
				
				
				<form th:action="|/product/${detail.pno}|" method="post">
				
					<dl class="flex">
						<dt>제목</dt>
						<dd>
							<div class="detail-default">
								<span th:text="${detail.title}"></span>
							</div>
							<div class="detail-update">
								<input type="text" name="title" th:value="${detail.title}">
							</div>
						</dd>
					</dl>
					
					<dl class="flex">
						<dt>가격</dt>
						<dd>
							<div class="detail-default">
								<span th:text="${detail.price}"></span>
							</div>
							<div class="detail-update">
								<input type="text" name="price" th:value="${detail.price}">
							</div>
						</dd>
					</dl>

					<dl class="flex">
						<dt>상품 이미지</dt>
						<dd>
						<th:block th:each="img:${files}">
							<div class="detail-default">
								<img alt="(이미지)" th:src="${img}" width="100px">
							</div>
						</th:block>
							<div class="detail-update">
								<img alt="(이미지)" th:src="${img}" width="100px">
							</div>
						</dd>
					</dl>
					
					<dl>
						<dt>상세 정보</dt>
						<dd>
							<div class="detail-default" th:utext="${detail.content}"></div>
							<div class="detail-update">
								<textarea id="summernote" name="content">[(${detail.content})]</textarea>
							</div>
						</dd>
					</dl>
					
					<div class="detail-update flex center">
						<button type="button" onclick="clickedBtnCancel()">취소</button>
						<input type="hidden" name="_method" value="put">
						<button type="submit">수정 완료</button>
					</div>
				</form>
				
				<section class="detail-default">
					<!--                       댓글                       -->
					<p class="tit">리뷰</p>
	
					<div class="wrap" th:each="review : ${review}">
						
						<dl class="flex">
							<dt>작성자</dt>
							<dd th:text="${review.writer}"></dd>
							<dd th:text="|(${review.createdDate})|"></dd>
						</dl>
	
						<dl class="flex">
							<dd th:text="${review.content}"></dd>
						</dl>
					</div>
					
					
					<!--                       댓글 입력                    -->
					<form th:action="|/products/${detail.pno}/review|" method="post">
						<input type="text" name="writer" th:value="${#authentication.name}" disabled="disabled" required="required">
						<input type="text" name="content" placeholder="댓글 입력" required="required">
						
						<button type="submit">댓글 등록</button>
					</form>
				</section>
				
				
				
				<div class="detail-default flex center">
					<a href="/products">
						<button type="button">목록</button>
					</a>
					
					<!-- onclick 속성은 ()호출 형식으로 입력하기 -->
					<th:block th:if="${#authentication.name == detail.seller}">
						<button type="button" onclick="clickedBtnUpdate()">수정</button>
					</th:block>

					<th:block th:if="${#authentication.name == detail.seller}">
						<form th:action="|/products/${detail.pno}|" method="post">
							<input type="hidden" name="_method" value="DELETE">
							<button type="submit">삭제</button>
						</form>
					</th:block>
					
					<!-- 관리자 삭제 버튼 -->
					<th:block sec:authorize="hasRole('ROLE_ADMIN')">
						<form th:action="|/products/${detail.pno}|" method="post">
							<input type="hidden" name="_method" value="patch">
							<button type="submit">삭제</button>
						</form>
					</th:block>
				</div>
			</div>
		</section>
		
		</div>
	</main>
	
</html>